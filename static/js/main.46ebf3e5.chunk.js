(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{162:function(e,n,t){},176:function(e,n,t){},222:function(e,n,t){},225:function(e,n,t){},228:function(e,n,t){},229:function(e,n,t){},230:function(e,n,t){"use strict";t.r(n);var c,a,s,r,i,o,u,j,l,d,b,m=t(2),O=t(144),h=t.n(O),g=(t(161),t(162),t(15)),f=t(145),x=t(152),p=t(56),v=t(11),k=t(44),N=t(231),y=t(232),w=t(234),C=(t(176),t(155)),M=(t(221),t(30)),I=t(13),$=(Object(I.a)(c||(c=Object(M.a)(["\n  query {\n    users {\n      id\n      nickname\n    }\n  }\n"]))),Object(I.a)(a||(a=Object(M.a)(["\n  query($id:ID!) {\n    user(id:$id) {\n      id\n      nickname\n    }\n  }\n"])))),S=Object(I.a)(s||(s=Object(M.a)(["\n  query {\n    usersOnline \n  }\n"]))),E=Object(I.a)(r||(r=Object(M.a)(["\n  query {\n    messages{\n      id\n      content\n      createdAt\n      user{\n        id\n        nickname\n      }\n    }\n  }\n"]))),L=Object(I.a)(i||(i=Object(M.a)(["\n  mutation($content:String!,$id:ID!,$nickname:String!){\n    createMessage(message:{\n      content:$content\n      user:{\n        id:$id\n        nickname:$nickname\n      }\n    }){\n      id\n      content\n      user{ \n        id\n        nickname\n      }\n      createdAt\n    }\n  }\n"]))),A=Object(I.a)(o||(o=Object(M.a)(["\n  mutation($nickname:String!){\n    loginUser(user:{nickname:$nickname}){\n      id\n      nickname\n    }\n  }\n"]))),D=Object(I.a)(u||(u=Object(M.a)(["\n  mutation($id:ID!, $nickname:String!){\n    logoutUser(user:{id:$id,nickname:$nickname})\n  }\n"]))),q=Object(I.a)(j||(j=Object(M.a)(["\n  subscription{\n    usersOnline\n  }\n"]))),T=Object(I.a)(l||(l=Object(M.a)(["\n  subscription{\n    newMessage{\n      content\n      createdAt\n      user{\n        id\n        nickname\n      }\n    }\n  }\n"]))),Q=(Object(I.a)(d||(d=Object(M.a)(["\n  subscription{\n    userLogin{\n      id\n      nickname\n    }\n  }\n"]))),Object(I.a)(b||(b=Object(M.a)(["\n  subscription{\n    userLogout{\n      id\n      nickname\n    }\n  }\n"]))),t(156)),F=(t(222),t(4));var R=function(e){var n=0,t=Object(g.useQuery)(S),c=t.subscribeToMore,a=Object(Q.a)(t,["subscribeToMore"]);return c({document:q,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var c=t.data.usersOnline;return console.log(c),Object.assign({},e,{usersOnline:c})}}),a.data&&(n=a.data.usersOnline),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("div",{className:"online"}),Object(F.jsxs)("span",{children:["Online: ",n]})]})};t(225);var U=function(e){var n=Object(v.f)(),t=e.user,c=Object(g.useMutation)(D,{onCompleted:function(e){e.logoutUser&&(localStorage.removeItem("token"),n.push("/"))}}),a=Object(k.a)(c,1)[0];return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)(w.a,{className:"logout-button btn-danger",onClick:function(){a({variables:{id:t.id,nickname:t.nickname}})},children:"Sair"})})},H=t(154);t(228);var B=function(e){var n=localStorage.getItem("token"),t={backgroundColor:"#393e46",marginRight:"auto",marginLeft:"1vw"};if(e.userId===n&&(t={backgroundColor:"#38ac85",marginLeft:"auto",marginRight:"1vw"}),null===e.userId)return t={margin:"auto"},Object(F.jsx)("div",{className:"Message",style:t,children:Object(F.jsx)("p",{className:"Corpo",children:e.content})});var c=new Date(e.createdAt),a=c.getHours()+":"+(c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes());return Object(F.jsxs)("div",{className:"Message",style:t,children:[Object(F.jsx)("h2",{className:"Titulo",children:e.user}),Object(F.jsxs)("p",{className:"Corpo",children:[e.content," ",Object(F.jsx)("span",{className:"Hora",children:a})]})]})};var J=function(e){var n=[],t=Object(m.useRef)(null);Object(m.useEffect)((function(){t.current&&t.current.scrollIntoView({behavior:"smooth"})}),[n]);var c=Object(g.useQuery)(E),a=c.loading,s=c.error,r=c.data;if((0,c.subscribeToMore)({document:T,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var c=t.data.newMessage;return Object.assign({},e,{messages:[c].concat(Object(H.a)(e.messages))})}}),a)return Object(F.jsx)("p",{children:"Loading..."});if(s)return Object(F.jsx)("p",{children:"Error :("});r&&(n=r.messages);var i=n.map((function(e){return Object(F.jsx)(B,{userId:e.user.id,user:e.user.nickname,content:e.content,createdAt:e.createdAt},e.id)}));return Object(F.jsxs)(F.Fragment,{children:[i,Object(F.jsx)("div",{ref:t})]})};function z(e){var n=Object(v.f)(),t={},c=localStorage.getItem("token")||n.push("/"),a=Object(m.useState)(""),s=Object(k.a)(a,2),r=s[0],i=s[1];Object(m.useEffect)((function(){var e=function(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||e.shiftKey||(""!==r?(u({variables:{content:r,id:t.id,nickname:t.nickname}}),i("")):(console.log(""===r),console.log(typeof r),console.log(r)))};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[r]);var o=Object(g.useMutation)(L),u=Object(k.a)(o,1)[0],j=Object(g.useQuery)($,{variables:{id:c}});return j.loading?Object(F.jsx)("p",{children:"Loading..."}):j.error?Object(F.jsx)("p",{children:"Error :("}):(j.data&&(t=j.data.user),Object(F.jsxs)("div",{className:"Chat",children:[Object(F.jsxs)("div",{className:"Title",children:[Object(F.jsxs)("span",{children:["Bem-vindo, ",t.nickname]}),Object(F.jsxs)("div",{className:"online-wrapper",children:[Object(F.jsx)(R,{}),Object(F.jsx)(U,{user:t})]})]}),Object(F.jsx)(C.a,{className:"Content",children:Object(F.jsx)(J,{})}),Object(F.jsxs)(N.a,{className:"send-message",children:[Object(F.jsx)(y.a,{xs:8,className:"send-message-input",children:Object(F.jsx)("textarea",{name:"",id:"",cols:"30",rows:"10",value:r,onChange:function(e){return i(e.target.value)}})}),Object(F.jsx)(y.a,{className:"send-message-button",children:Object(F.jsx)(w.a,{className:"form-buttom",onClick:function(){u({variables:{content:r,id:t.id,nickname:t.nickname}}),i("")},children:"Enviar"})})]})]}))}var K=t(96),P=t(233);t(229);function V(e){var n=Object(v.f)(),t=Object(m.useState)({id:"",nickname:""}),c=Object(k.a)(t,2),a=c[0],s=c[1];localStorage.getItem("token")&&n.push("/chat");var r=Object(g.useMutation)(A,{onCompleted:function(e){var t=e.loginUser;t&&(localStorage.setItem("token",t.id),n.push("/chat"))}}),i=Object(k.a)(r,1)[0];return Object(F.jsx)(P.a,{className:"user-container",children:Object(F.jsxs)("div",{className:"user-wrapper",children:[Object(F.jsx)(N.a,{className:"justify-content-md-center",children:Object(F.jsx)(y.a,{md:6,children:Object(F.jsx)("h1",{children:"Escolha o seu Nickname:"})})}),Object(F.jsx)(N.a,{className:"justify-content-md-center",children:Object(F.jsx)(y.a,{md:6,children:Object(F.jsx)("form",{className:"form-card",onSubmit:function(e){return function(e){e.preventDefault(),i({variables:{nickname:a.nickname}})}(e)},children:Object(F.jsxs)(N.a,{className:"justify-content-md-center",children:[Object(F.jsx)(y.a,{xs:8,children:Object(F.jsx)("input",{className:"user-input",value:a.nickname,onChange:function(e){return s(Object(K.a)(Object(K.a)({},a),{},{nickname:e.target.value}))}})}),Object(F.jsx)(y.a,{xs:4,children:Object(F.jsx)(w.a,{type:"submit",className:"form-buttom",children:"Entrar no Chat"})})]})})})})]})})}function G(e){return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)(p.a,{children:Object(F.jsxs)(v.c,{children:[Object(F.jsx)(v.a,{path:"/chat",children:Object(F.jsx)(z,{titulo:"Chat"})}),Object(F.jsx)(v.a,{path:"/",children:Object(F.jsx)(V,{titulo:"Registre-se"})})]})})})}var W=new g.HttpLink({uri:"http://localhost:4000/"}),X=new f.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0,lazy:!0,inactivityTimeout:3e4}}),Y=Object(g.split)((function(e){var n=e.query,t=Object(x.a)(n),c=t.kind,a=t.operation;return"OperationDefinition"===c&&"subscription"===a}),X,W),Z=new g.ApolloClient({link:Y,cache:new g.InMemoryCache});h.a.render(Object(F.jsx)(g.ApolloProvider,{client:Z,children:Object(F.jsx)(G,{})}),document.getElementById("root"))}},[[230,1,2]]]);
//# sourceMappingURL=main.46ebf3e5.chunk.js.map